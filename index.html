<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>[CMPT-276]: CHIP-8 Emulator</title>

    <style>
        body {color: black;}
        textarea{  /* For the [Memory] Scroll Box */
                width : 400px;
                height: 280px;
            
                resize: none;
                display: inline-block;

                border-color: black;
                background-color: rgb(124, 122, 122);
                border: 2px solid black;
                padding-right: 10px;
                padding: 20px;

                font-family: 'Courier New', Courier, monospace;
                color: white;
                overflow: auto;
            }
    </style>
</head>
<body>
    <center><canvas id="chipScreen" width="640" height="320" style="border: 2px solid black"> </canvas></center>
    
    
    <script src = "Chip8.js"></script>
    <script src = "visual.js"></script>
    <script>
        // console.log("1234 & 0xf000: " + (1234 & 0xf000));
        var cpu = new CPU();
        var canv = document.getElementById("chipScreen");
        var rend = new Renderer(canv, cpu.getHeight(), cpu.getWidth(), 
                                    10);
        
        
        cpu.randomizeMemory();
        cpu.setRenderer(rend);
        cpu.initRegisters();
        // cpu.startup();  
        cpu.cycle();
        
        var testHex = [ //fuck
            0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
            0x20, 0x60, 0x20, 0x20, 0x70, // 1
            0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
            0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
            0x90, 0x90, 0xF0, 0x10, 0x10, // 4
            0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
            0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
            0xF0, 0x10, 0x20, 0x40, 0x40, // 7
            0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
            0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
            0xF0, 0x90, 0xF0, 0x90, 0x90, // A
            0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
            0xF0, 0x80, 0x80, 0x80, 0xF0, // C
            0xE0, 0x90, 0x90, 0x90, 0xE0, // D
            0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
            0xF0, 0x80, 0xF0, 0x80, 0x80  // F
        ];

    // console.log(testHex[0].toString(16));//WORKS: GIVES YOU "FF"
        // var hexArr = [0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0x4A, 0x46, 0x49, 0x46, 0x00, 0x01, 0x01, 0x01, 0x00, 0x60];
        // var hexArr = [0x01];
        for (let i = 0, x = 0, y = 0; i < testHex.length / 5; i++, x++) {
            if (x >= 8) {
                y++;
                x = 0;
            }

            cpu.drawIntoDisplayArray(testHex.slice(i * 5, (i + 1) * 5), x * 6, y * 6, 5); // sprite, x, y, h
        }
    </script> <!-- Primary CPU Activation and Display Testing (Manual) --> 

    <textarea id="memory"></textarea>
    <script>
        var memo = document.getElementById("memory");
        var memArr = cpu.getMemory();
        
        // let idx = 0x200;
        setInterval(function() {
            cpu.cycle();
            let pc = cpu.getProgramCounter();
            if(memArr[pc] > 0 ) {
                memo.textContent += "Opcode: " + cpu.getOpcode() + "\nPC: " + pc + "\nMemory: " + memArr[pc] + "\n\n";
            }
            scrollToBottom();
            
            // idx++;
        },1000); //1 second
        var scrollToBottom = function() {
            let height = memo.getBoundingClientRect().height;
            if (Math.abs(memo.scrollHeight - memo.scrollTop - height) < 80) {
                memo.scrollTop = memo.scrollHeight - height;
            }
        };
    </script> <!-- Memory box (: Will add more soon! -->


    <!-- <script>
        setInterval(function() {
            if(cpu.running === true) {
                console.log("FUCK");
                cpu.drawFlag = true;
                // cpu.cycle();
                
                if(cpu.drawFlag == true) {
                    
                
                    console.log("DRAW");
                    cpu.drawOntoScreen();
                }
            }
        }, 2000); //2 seconds
    </script> -->

</body>

</html>
